<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>小小白杨</title>
  <subtitle>I&#39;m a fatal bug!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://baiyangliu.com/"/>
  <updated>2016-12-29T11:38:00.170Z</updated>
  <id>https://baiyangliu.com/</id>
  
  <author>
    <name>baiyangliu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用rsync进行增量代码部署</title>
    <link href="https://baiyangliu.com/%E4%BD%BF%E7%94%A8rsync%E8%BF%9B%E8%A1%8C%E5%A2%9E%E9%87%8F%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2.html"/>
    <id>https://baiyangliu.com/使用rsync进行增量代码部署.html</id>
    <published>2016-12-28T09:21:39.000Z</published>
    <updated>2016-12-29T11:38:00.170Z</updated>
    
    <content type="html"><![CDATA[<h5 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h5><p>做过Java开发的都知道，Java有着丰富的类库，你所想要的功能，几乎都有开源实现。但问题是，依赖库的递归依赖，使得编译出的文件非常庞大。再者，每次重新部署，其实都只做了“相当少”的代码更新。如果是在公网环境，情况会更加糟糕。。。</p>
<blockquote>
<p>rsync是类unix系统下的数据镜像备份工具——remote sync。一款快速增量备份工具 Remote Sync，远程同步 支持本地复制，或者与其他SSH、rsync主机同步。</p>
</blockquote>
<a id="more"></a>
<h5 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h5><p>如上所述，既然每次都做了大量的无用功，能不能避免呢？当然可以，rsync就可以做到。本文以Spring Boot程序为例，对于静态文件、PHP、NodeJS等都适用。服务端使用CentOS7.2，客户端Windows10。</p>
<h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><h6 id="服务端安装"><a href="#服务端安装" class="headerlink" title="服务端安装"></a>服务端安装</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> rsync -y</div><div class="line">systemctl <span class="keyword">enable</span> rsyncd.service</div></pre></td></tr></table></figure>
<h6 id="修改配置文件vim-etc-rsyncd-conf"><a href="#修改配置文件vim-etc-rsyncd-conf" class="headerlink" title="修改配置文件vim /etc/rsyncd.conf"></a>修改配置文件<code>vim /etc/rsyncd.conf</code></h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#认证用户名和密码文件的名称和位置</span></div><div class="line">secrets file = /etc/rsyncd.secrets</div><div class="line"><span class="comment">#欢迎文件，可自己编辑</span></div><div class="line">motd file = /etc/rsyncd.motd</div><div class="line"><span class="built_in">read</span>&gt;list = yes</div><div class="line">uid = root</div><div class="line">gid = root</div><div class="line">use chroot = no</div><div class="line">max connections = 5</div><div class="line"><span class="built_in">log</span> file = /var/<span class="built_in">log</span>/rsyncd.log</div><div class="line">pid file = /var/run/rsyncd.pid</div><div class="line">lock file = /var/run/rsync.lock</div><div class="line"></div><div class="line">[app]</div><div class="line">comment = app</div><div class="line">path = /opt/deploy</div><div class="line">auth users = user1</div><div class="line"><span class="built_in">read</span> only = no</div></pre></td></tr></table></figure>
<h6 id="生成密码文件"><a href="#生成密码文件" class="headerlink" title="生成密码文件"></a>生成密码文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">echo</span> <span class="string">"user1:123456"</span> &gt;&gt; /etc/rsyncd.secrets</div><div class="line">chmod 600 /etc/rsyncd.secrets</div></pre></td></tr></table></figure>
<h6 id="添加防火墙例外"><a href="#添加防火墙例外" class="headerlink" title="添加防火墙例外"></a>添加防火墙例外</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=dmz --add-port=873/tcp --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure>
<h6 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start rsyncd</div></pre></td></tr></table></figure>
<h6 id="编译脚本（build-bat）"><a href="#编译脚本（build-bat）" class="headerlink" title="编译脚本（build.bat）"></a>编译脚本（build.bat）</h6><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">@echo off</div><div class="line"></div><div class="line">set "CURRENT_DIR=%cd%"</div><div class="line">svn co https://xxx %TMP%\xxx</div><div class="line">svn update "%TMP%\xxx"</div><div class="line"></div><div class="line">cd /D "%TMP%\xxx"</div><div class="line"></div><div class="line">call gradle clean bootRepackage</div><div class="line"></div><div class="line">call unzip -o   xxx/build/libs/*.jar -d xxx/build/libs/xxx</div><div class="line"></div><div class="line">cd xxx/build/libs/xxx</div><div class="line"></div><div class="line">set "src=/cygdrive/%CD::=/%"</div><div class="line">set "src=%src:\=/%"</div><div class="line"></div><div class="line">cd /D %CURRENT_DIR%</div><div class="line"></div><div class="line">rem rsync下载地址(http://www.brentnorris.net/rsync.zip)</div><div class="line">call rsync -vzrtopg --delete --progress --password-file=./rsyncd.secrets %src% user1@你的服务器地址::app</div><div class="line"></div><div class="line"></div><div class="line">rem plink下载地址(https://the.earth.li/~sgtatham/putty/latest/x86/plink.exe)</div><div class="line">call plink -ssh root@你的服务器地址 systemctl daemon-reload</div><div class="line">call plink -ssh root@你的服务器地址 systemctl enable  "xxx.service"</div><div class="line">call plink -ssh root@你的服务器地址 systemctl restart "xxx.service"</div><div class="line"></div><div class="line">cd /D %CURRENT_DIR%</div></pre></td></tr></table></figure>
<p>注意：rsyncd.secrets文件内容为123456。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h5 id=&quot;问题来源&quot;&gt;&lt;a href=&quot;#问题来源&quot; class=&quot;headerlink&quot; title=&quot;问题来源&quot;&gt;&lt;/a&gt;问题来源&lt;/h5&gt;&lt;p&gt;做过Java开发的都知道，Java有着丰富的类库，你所想要的功能，几乎都有开源实现。但问题是，依赖库的递归依赖，使得编译出的文件非常庞大。再者，每次重新部署，其实都只做了“相当少”的代码更新。如果是在公网环境，情况会更加糟糕。。。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rsync是类unix系统下的数据镜像备份工具——remote sync。一款快速增量备份工具 Remote Sync，远程同步 支持本地复制，或者与其他SSH、rsync主机同步。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="工具" scheme="https://baiyangliu.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="rsync" scheme="https://baiyangliu.com/tags/rsync/"/>
    
  </entry>
  
  <entry>
    <title>Nginx配置优化之启用keep-alive</title>
    <link href="https://baiyangliu.com/Nginx%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%AF%E7%94%A8keep-alive.html"/>
    <id>https://baiyangliu.com/Nginx配置优化之启用keep-alive.html</id>
    <published>2016-12-26T06:56:16.000Z</published>
    <updated>2016-12-26T09:47:15.682Z</updated>
    
    <content type="html"><![CDATA[<h6 id="默认配置时"><a href="#默认配置时" class="headerlink" title="默认配置时"></a>默认配置时</h6><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</div><div class="line"><span class="attribute">Host</span>: baiyangliu.com</div><div class="line"><span class="attribute">X-Real-IP</span>: 192.168.1.1</div><div class="line"><span class="attribute">X-Forwarded-For</span>: 192.168.1.1</div><div class="line"><span class="attribute">X-Forwarded-Proto</span>: https</div><div class="line"><span class="attribute">X-Forwarded-Port</span>: 443</div><div class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div><div class="line"><span class="attribute">Connection</span>: close</div></pre></td></tr></table></figure>
<h6 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">proxy_http_version    1.1;</div><div class="line"></div><div class="line">upstream backends &#123;</div><div class="line">    server 192.168.1.129;</div><div class="line">    keepalive 128;</div><div class="line">&#125;</div><div class="line"></div><div class="line">locatioin / &#123;</div><div class="line">    proxy_set_header  Connection &quot;keep-alive&quot;;</div><div class="line">    proxy_pass        http://backends;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="再次请求"><a href="#再次请求" class="headerlink" title="再次请求"></a>再次请求</h6><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</div><div class="line"><span class="attribute">Host</span>: baiyangliu.com</div><div class="line"><span class="attribute">X-Real-IP</span>: 192.168.1.1</div><div class="line"><span class="attribute">X-Forwarded-For</span>: 192.168.1.1</div><div class="line"><span class="attribute">X-Forwarded-Proto</span>: https</div><div class="line"><span class="attribute">X-Forwarded-Port</span>: 443</div><div class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div><div class="line"><span class="attribute">Connection</span>: keep-alive</div></pre></td></tr></table></figure>
<p>可以发现<code>HTTP/1.0</code>变成<code>HTTP/1.1</code>，<code>Connection: close</code>变成<code>Connection: keep-alive</code>。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h6 id=&quot;默认配置时&quot;&gt;&lt;a href=&quot;#默认配置时&quot; class=&quot;headerlink&quot; title=&quot;默认配置时&quot;&gt;&lt;/a&gt;默认配置时&lt;/h6&gt;&lt;figure class=&quot;highlight http&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;
    
    </summary>
    
      <category term="Nginx" scheme="https://baiyangliu.com/categories/Nginx/"/>
    
    
      <category term="Nginx" scheme="https://baiyangliu.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Nginx配置优化之启用HTTP1.1</title>
    <link href="https://baiyangliu.com/Nginx%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%AF%E7%94%A8HTTP1.1.html"/>
    <id>https://baiyangliu.com/Nginx配置优化之启用HTTP1.1.html</id>
    <published>2016-12-26T06:15:32.000Z</published>
    <updated>2016-12-27T11:07:56.387Z</updated>
    
    <content type="html"><![CDATA[<h6 id="默认配置时"><a href="#默认配置时" class="headerlink" title="默认配置时"></a>默认配置时</h6><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.0</div><div class="line"><span class="attribute">Host</span>: baiyangliu.com</div><div class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div></pre></td></tr></table></figure>
<h6 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">proxy_http_version    1.1;</div></pre></td></tr></table></figure>
<h6 id="再次请求"><a href="#再次请求" class="headerlink" title="再次请求"></a>再次请求</h6><figure class="highlight http"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</div><div class="line"><span class="attribute">Host</span>: baiyangliu.com</div><div class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div></pre></td></tr></table></figure>
<p>可以发现<code>HTTP/1.0</code>变成<code>HTTP/1.1</code>。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h6 id=&quot;默认配置时&quot;&gt;&lt;a href=&quot;#默认配置时&quot; class=&quot;headerlink&quot; title=&quot;默认配置时&quot;&gt;&lt;/a&gt;默认配置时&lt;/h6&gt;&lt;figure class=&quot;highlight http&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;
    
    </summary>
    
      <category term="Nginx" scheme="https://baiyangliu.com/categories/Nginx/"/>
    
    
      <category term="Nginx" scheme="https://baiyangliu.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>You can&#39;t specify target table &#39;department_user&#39; for update in FROM clause</title>
    <link href="https://baiyangliu.com/You-can-t-specify-target-table-xxx-for-update-in-FROM-clause.html"/>
    <id>https://baiyangliu.com/You-can-t-specify-target-table-xxx-for-update-in-FROM-clause.html</id>
    <published>2016-12-22T09:51:00.000Z</published>
    <updated>2016-12-22T10:24:39.903Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/imgs/fatalbug.png" alt="JSON"><br><a id="more"></a></p>
<h6 id="出现原因"><a href="#出现原因" class="headerlink" title="出现原因"></a>出现原因</h6><p>MySQL中对同一张表Select的结果进行更新（删除）操作</p>
<h6 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h6><p>删除部门，要求将部门用户移动到父部门</p>
<h6 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h6><p>由于用户可能同时存在于本部门和父部门，因此在进行更新之前，需要将此类用户查出来直接删掉，然后更新部门ID。</p>
<h6 id="出错SQL"><a href="#出错SQL" class="headerlink" title="出错SQL"></a>出错SQL</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">DELETE</span></div><div class="line"><span class="keyword">FROM</span></div><div class="line">    department_user</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">    department_id = ?</div><div class="line"><span class="keyword">AND</span> user_id <span class="keyword">IN</span> (</div><div class="line">    <span class="keyword">SELECT</span></div><div class="line">        user_id</div><div class="line">    <span class="keyword">FROM</span></div><div class="line">        department_user</div><div class="line">    <span class="keyword">WHERE</span></div><div class="line">        department_id = ?</div><div class="line">    <span class="keyword">AND</span> user_id <span class="keyword">IN</span> (</div><div class="line">        <span class="keyword">SELECT</span></div><div class="line">            user_id</div><div class="line">        <span class="keyword">FROM</span></div><div class="line">            department_user</div><div class="line">        <span class="keyword">WHERE</span></div><div class="line">            department_id = ?</div><div class="line">    )</div><div class="line">)</div></pre></td></tr></table></figure>
<h6 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h6><p>将Select的中间结果再次Select。。。</p>
<h6 id="正确SQL"><a href="#正确SQL" class="headerlink" title="正确SQL"></a>正确SQL</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">DELETE</span></div><div class="line"><span class="keyword">FROM</span></div><div class="line">    department_user</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">    department_id = ?</div><div class="line"><span class="keyword">AND</span> user_id <span class="keyword">IN</span> (</div><div class="line">    <span class="keyword">SELECT</span></div><div class="line">        t.user_id</div><div class="line">    <span class="keyword">FROM</span></div><div class="line">        (</div><div class="line">            <span class="keyword">SELECT</span></div><div class="line">                user_id</div><div class="line">            <span class="keyword">FROM</span></div><div class="line">                department_user</div><div class="line">            <span class="keyword">WHERE</span></div><div class="line">                department_id = ?</div><div class="line">            <span class="keyword">AND</span> user_id <span class="keyword">IN</span> (</div><div class="line">                <span class="keyword">SELECT</span></div><div class="line">                    user_id</div><div class="line">                <span class="keyword">FROM</span></div><div class="line">                    department_user</div><div class="line">                <span class="keyword">WHERE</span></div><div class="line">                    department_id = ?</div><div class="line">            )</div><div class="line">        ) t</div><div class="line">)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      You can&#39;t specify target table &#39;department_user&#39; for update in FROM clause
    
    </summary>
    
      <category term="编码" scheme="https://baiyangliu.com/categories/%E7%BC%96%E7%A0%81/"/>
    
    
      <category term="MySQL" scheme="https://baiyangliu.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>JSON压缩方案</title>
    <link href="https://baiyangliu.com/JSON%E5%8E%8B%E7%BC%A9%E6%96%B9%E6%A1%88.html"/>
    <id>https://baiyangliu.com/JSON压缩方案.html</id>
    <published>2015-12-15T07:38:41.000Z</published>
    <updated>2016-12-22T01:36:39.475Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/imgs/json.png" alt="JSON"><br><a id="more"></a><br>关于JSON，大家耳熟能详，不做多说，今天在这里分享一下关于JSON压缩的几点方案。</p>
<h5 id="1-压缩Key"><a href="#1-压缩Key" class="headerlink" title="1.压缩Key"></a>1.压缩Key</h5><p>原始JSON（长度：79）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"username"</span>: <span class="string">"张三"</span>,</div><div class="line">    <span class="string">"gender"</span>: <span class="string">"M"</span>,</div><div class="line">    <span class="string">"age"</span>: <span class="number">38</span>,</div><div class="line">    <span class="string">"email"</span>: <span class="string">"a@b.com"</span>,</div><div class="line">    <span class="string">"phone"</span>: <span class="string">"15818376578"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>压缩Key以后（长度：57）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"a"</span>: <span class="string">"张三"</span>,</div><div class="line">    <span class="string">"b"</span>: <span class="string">"M"</span>,</div><div class="line">    <span class="string">"c"</span>: <span class="number">38</span>,</div><div class="line">    <span class="string">"d"</span>: <span class="string">"a@b.com"</span>,</div><div class="line">    <span class="string">"e"</span>: <span class="string">"15818376578"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>体积减小<strong><font color="red">27.85%</font></strong>，对于高并发的服务而言，此数字相当可观！！！<br>那么，是不是所有的Restful都可以采用这种方案来进行压缩呢？答案是否定的。首先，Key压缩损失了JSON的可读性，这就要求必须事先进行约定，增加了出错的风险；其次，对于JSON中含有较长Value字段的，压缩效果不是很明显，可能得不偿失。<br>附：如果采用Jackson，那么对username的压缩实现为@JsonProperty(“a”)  </p>
<h5 id="2-省略Key"><a href="#2-省略Key" class="headerlink" title="2.省略Key"></a>2.省略Key</h5><p>如果说方案1不解渴，那就来个更彻底的，直接省略掉Key！！！  </p>
<p>原始JSON（长度：79）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"username"</span>: <span class="string">"张三"</span>,</div><div class="line">    <span class="string">"gender"</span>: <span class="string">"M"</span>,</div><div class="line">    <span class="string">"age"</span>: <span class="number">38</span>,</div><div class="line">    <span class="string">"email"</span>: <span class="string">"a@b.com"</span>,</div><div class="line">    <span class="string">"phone"</span>: <span class="string">"15818376578"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>省略Key以后（长度：37）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">    <span class="string">"张三"</span>,</div><div class="line">    <span class="string">"M"</span>,</div><div class="line">    <span class="number">38</span>,</div><div class="line">    <span class="string">"a@b.com"</span>,</div><div class="line">    <span class="string">"15818376578"</span></div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>体积减小<strong><font color="red">53.16%</font></strong>，Oh,mygod!!!<br>当然缺点就是将对象转换成了数组，这就要求字段顺序必须有保证（这个不难，排序一下就好），并且对于0或者null字段也不可省略。</p>
<h5 id="3-字典压缩"><a href="#3-字典压缩" class="headerlink" title="3.字典压缩"></a>3.字典压缩</h5><p>改进版的方案1，即：预先分析所有的字段，然后对字段名称进行编码（缩写），得到编码字典，之后的JSON生成和解析依赖于该字典，这样就可以进行高效的“压缩”和“解压”。此过程无需改动（侵入）现有代码，实现时，仅需对输入和输出进行过滤。</p>
<p>以上几种方案都是针对客户端为浏览器的情况下进行的改造，兼容性强，改动量都不是很大，却可以获得不错的性能提升。如果是服务与服务之间的通信，则完全可以替换掉JSON，比如Goole的Protobuf。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/imgs/json.png&quot; alt=&quot;JSON&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="高性能" scheme="https://baiyangliu.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD/"/>
    
    
      <category term="JSON" scheme="https://baiyangliu.com/tags/JSON/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7 Strongswan IKEV2 Let&#39;s Encrypt</title>
    <link href="https://baiyangliu.com/CentOS7-Strongswan-IKEV2-Let-s-Encrypt.html"/>
    <id>https://baiyangliu.com/CentOS7-Strongswan-IKEV2-Let-s-Encrypt.html</id>
    <published>2015-12-15T07:37:08.000Z</published>
    <updated>2016-12-22T01:37:00.790Z</updated>
    
    <content type="html"><![CDATA[<p>前面介绍了如入用自签名证书，请参见<a href="http://0xa.in/aaaaa9" target="_blank" rel="external">CentOS7 Strongswan IKEV2 架设梯子</a>，这里介绍如何利用Let’s Encrypt签发证书省去导入的麻烦。<br><a id="more"></a><br>关于证书签发，请参见<a href="https://github.com/Neilpang/acme.sh" target="_blank" rel="external">acme.sh</a>，由于本站的域名已转移至<a href="https://godaddy.com/" target="_blank" rel="external">Godaddy</a>，利用acme.sh可以实现全自动证书签发。</p>
<p>签发完后，证书位于<code>/root/.acme.sh/0xa.in</code>目录下（请查看本站证书详情）。<br>接下来，执行以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/strongswan/ipsec.d/certs</div><div class="line">ln <span class="_">-s</span> /root/.acme.sh/0xa.in/fullchain.cer fullchain.cer</div><div class="line"><span class="built_in">cd</span> /etc/strongswan/ipsec.d/private</div><div class="line">ln <span class="_">-s</span> /root/.acme.sh/0xa.in/0xa.in.key 0xa.in.key</div><div class="line"><span class="built_in">cd</span> /etc/strongswan/ipsec.d/cacerts</div><div class="line">ln <span class="_">-s</span> /root/.acme.sh/0xa.in/ca.cer ca.cer</div></pre></td></tr></table></figure></p>
<p>到这里，很多人会忘记配置根证书，从而出现错误“13801:IKE身份验证凭证不可接受”。解决办法是把<code>DST ROOT CA X3</code>给导入进来，以下是dst_root_ca_x3.cer</p>
<p>vim /etc/strongswan/ipsec.d/cacerts/dst_root_ca_x3.cer<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">-----BEGIN CERTIFICATE-----</div><div class="line">MIIDSjCCAjKgAwIBAgIQRK+wgNajJ7qJMDmGLvhAazANBgkqhkiG9w0BAQUFADA/</div><div class="line">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT</div><div class="line">DkRTVCBSb290IENBIFgzMB4XDTAwMDkzMDIxMTIxOVoXDTIxMDkzMDE0MDExNVow</div><div class="line">PzEkMCIGA1UEChMbRGlnaXRhbCBTaWduYXR1cmUgVHJ1c3QgQ28uMRcwFQYDVQQD</div><div class="line">Ew5EU1QgUm9vdCBDQSBYMzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB</div><div class="line">AN+v6ZdQCINXtMxiZfaQguzH0yxrMMpb7NnDfcdAwRgUi+DoM3ZJKuM/IUmTrE4O</div><div class="line">rz5Iy2Xu/NMhD2XSKtkyj4zl93ewEnu1lcCJo6m67XMuegwGMoOifooUMM0RoOEq</div><div class="line">OLl5CjH9UL2AZd+3UWODyOKIYepLYYHsUmu5ouJLGiifSKOeDNoJjj4XLh7dIN9b</div><div class="line">xiqKqy69cK3FCxolkHRyxXtqqzTWMIn/5WgTe1QLyNau7Fqckh49ZLOMxt+/yUFw</div><div class="line">7BZy1SbsOFU5Q9D8/RhcQPGX69Wam40dutolucbY38EVAjqr2m7xPi71XAicPNaD</div><div class="line">aeQQmxkqtilX4+U9m5/wAl0CAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAOBgNV</div><div class="line">HQ8BAf8EBAMCAQYwHQYDVR0OBBYEFMSnsaR7LHH62+FLkHX/xBVghYkQMA0GCSqG</div><div class="line">SIb3DQEBBQUAA4IBAQCjGiybFwBcqR7uKGY3Or+Dxz9LwwmglSBd49lZRNI+DT69</div><div class="line">ikugdB/OEIKcdBodfpga3csTS7MgROSR6cz8faXbauX+5v3gTt23ADq1cEmv8uXr</div><div class="line">AvHRAosZy5Q6XkjEGB5YGV8eAlrwDPGxrancWYaLbumR9YbK+rlmM6pZW87ipxZz</div><div class="line">R8srzJmwN0jP41ZL9c8PDHIyh8bwRLtTcm1D9SZImlJnt1ir/md2cXjbDaJWFBM5</div><div class="line">JDGFoqgCWjBH4d1QB7wCCZAA62RjYJsWvIjJEubSfZGL+T0yjWW06XyxV3bqxbYo</div><div class="line">Ob8VZRzI9neWagqNdwvYkQsEjgfbKbYK7p2CNTUQ</div><div class="line">-----END CERTIFICATE-----</div></pre></td></tr></table></figure></p>
<p>修改 /etc/strongswan/ipsec.conf，<code>leftcert=fullchain.cer</code></p>
<p>修改 /etc/strongswan/ipsec.secrets，<code>: RSA 0xa.in.key</code></p>
<p>重启服务，<code>strongswan restart</code>。</p>
<p>客户端连接的时候就不需要导入证书了。。。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前面介绍了如入用自签名证书，请参见&lt;a href=&quot;http://0xa.in/aaaaa9&quot;&gt;CentOS7 Strongswan IKEV2 架设梯子&lt;/a&gt;，这里介绍如何利用Let’s Encrypt签发证书省去导入的麻烦。&lt;br&gt;
    
    </summary>
    
      <category term="科学上网" scheme="https://baiyangliu.com/categories/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
    
      <category term="Strongswan" scheme="https://baiyangliu.com/tags/Strongswan/"/>
    
  </entry>
  
  <entry>
    <title>Nginx HPKP Config</title>
    <link href="https://baiyangliu.com/Nginx-HPKP-Config.html"/>
    <id>https://baiyangliu.com/Nginx-HPKP-Config.html</id>
    <published>2015-12-15T07:36:28.000Z</published>
    <updated>2016-12-22T02:18:53.204Z</updated>
    
    <content type="html"><![CDATA[<p>以本站为例，采用的是Let’s Encrypt免费证书<code>Let&#39;s Encrypt Authority X3</code>，序列号为<code>‎0a 01 41 42 00 00 01 53 85 73 6a 0b 85 ec a7 08</code>，以下是ca.cer<br><a id="more"></a><br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">-----BEGIN CERTIFICATE-----</div><div class="line">MIIEkjCCA<span class="number">3</span>qgAwIBAgIQCgFBQgAAAVOFc<span class="number">2</span>oLheynCDANBgkqhkiG<span class="number">9</span>w<span class="number">0</span>BAQsFADA/</div><div class="line">MSQwIgYDVQQKExtEaWdpdGFsIFNpZ<span class="number">25</span>hdHVyZSBUcnVzdCBDby<span class="number">4</span>xFzAVBgNVBAMT</div><div class="line">DkRTVCBSb<span class="number">290</span>IENBIFgzMB<span class="number">4</span>XDTE<span class="number">2</span>MDMxNzE<span class="number">2</span>NDA<span class="number">0</span>NloXDTIxMDMxNzE<span class="number">2</span>NDA<span class="number">0</span>Nlow</div><div class="line">SjELMAkGA<span class="number">1</span>UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY<span class="number">3</span>J<span class="number">5</span>cHQxIzAhBgNVBAMT</div><div class="line">GkxldCdzIEVuY<span class="number">3</span>J<span class="number">5</span>cHQgQXV<span class="number">0</span>aG<span class="number">9</span>yaXR<span class="number">5</span>IFgzMIIBIjANBgkqhkiG<span class="number">9</span>w<span class="number">0</span>BAQEFAAOC</div><div class="line">AQ<span class="number">8</span>AMIIBCgKCAQEAnNMM<span class="number">8</span>FrlLke<span class="number">3</span>cl<span class="number">03</span>g<span class="number">7</span>NoYzDq<span class="number">1</span>zUmGSXhvb<span class="number">418</span>XCSL<span class="number">7e4</span>S<span class="number">0</span>EF</div><div class="line">q<span class="number">6</span>meNQhY<span class="number">7</span>LEqxGiHC<span class="number">6</span>PjdeTm<span class="number">86</span>dicbp<span class="number">5</span>gWAf<span class="number">15</span>Gan/PQeGdxyGkOlZHP/uaZ<span class="number">6</span>WA<span class="number">8</span></div><div class="line">SMx+yk<span class="number">13</span>EiSdRxta<span class="number">67</span>nsHjcAHJyse<span class="number">6</span>cF<span class="number">6</span>s<span class="number">5</span>K<span class="number">671</span>B<span class="number">5</span>TaYucv<span class="number">9</span>bTyWaN<span class="number">8</span>jKkKQDIZ<span class="number">0</span></div><div class="line">Z<span class="number">8</span>h/pZq<span class="number">4</span>UmEUEz<span class="number">9</span>l<span class="number">6</span>YKHy<span class="number">9</span>v<span class="number">6</span>Dlb<span class="number">2</span>honzhT+Xhq+w<span class="number">3</span>Brvaw<span class="number">2</span>VFn<span class="number">3</span>EK<span class="number">6</span>BlspkENnWA</div><div class="line">a<span class="number">6</span>xK<span class="number">8</span>xuQSXgvopZPKiAlKQTGdMDQMc<span class="number">2</span>PMTiVFrqoM<span class="number">7</span>hD<span class="number">8</span>bEfwzB/onkxEz<span class="number">0</span>tNvjj</div><div class="line">/PIzark<span class="number">5</span>McWvxI<span class="number">0</span>NHWQWM<span class="number">6</span>r<span class="number">6</span>hCm<span class="number">21</span>AvA<span class="number">2</span>H<span class="number">3</span>DkwIDAQABo<span class="number">4</span>IBfTCCAXkwEgYDVR<span class="number">0</span>T</div><div class="line">AQH/BAgwBgEB/wIBADAOBgNVHQ<span class="number">8</span>BAf<span class="number">8</span>EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIG</div><div class="line">CCsGAQUFBzABhiZodHRwO<span class="keyword">i8</span>vaXNyZy<span class="number">50</span>cnVzdGlkLm<span class="number">9</span>jc<span class="number">3</span>AuaWRlbnRydXN<span class="number">0</span>LmNv</div><div class="line">bTA<span class="number">7</span>BggrBgEFBQcwAoYvaHR<span class="number">0</span>cDovL<span class="number">2</span>FwcHMuaWRlbnRydXN<span class="number">0</span>LmNvbS<span class="number">9</span>yb<span class="number">290</span>cy<span class="number">9</span>k</div><div class="line"><span class="keyword">c</span><span class="number">3</span>Ryb<span class="number">290</span>Y<span class="number">2</span>F<span class="number">4</span>My<span class="number">5</span>wN<span class="number">2</span>MwHwYDVR<span class="number">0</span>jBBgwFoAUxKexpHsscfrb<span class="number">4</span>UuQdf/EFWCFiRAw</div><div class="line">VAYDVR<span class="number">0</span>gBE<span class="number">0</span>wSzAIBgZngQwBAgEwPwYLKwYBBAGC<span class="number">3</span>xMBAQEwMDAuBggrBgEFBQcC</div><div class="line">ARYiaHR<span class="number">0</span>cDovL<span class="number">2</span>Nwcy<span class="number">5</span>yb<span class="number">290</span>LXgxLmxldHNlbmNyeXB<span class="number">0</span>Lm<span class="number">9</span>yZzA<span class="number">8</span>BgNVHR<span class="number">8</span>ENTAz</div><div class="line">MDGgL<span class="number">6</span>AthitodHRwO<span class="keyword">i8</span>vY<span class="number">3</span>JsLmlkZW<span class="number">50</span>cnVzdC<span class="number">5</span>jb<span class="number">20</span>vRFNUUk<span class="number">9</span>PVENBWDNDUkwu</div><div class="line">Y<span class="number">3</span>JsMB<span class="number">0</span>GA<span class="number">1</span>UdDgQWBBSoSmpjBH<span class="number">3</span>duubRObemRWXv<span class="number">86</span>jsoTANBgkqhkiG<span class="number">9</span>w<span class="number">0</span>BAQsF</div><div class="line">AAOCAQEA<span class="number">3</span>TPXEfNjWDjdGBX<span class="number">7</span>CVW+dla<span class="number">5</span>cEilaUcne<span class="number">8</span>IkCJLxWh<span class="number">9</span>KEik<span class="number">3</span>JHRRHGJo</div><div class="line">uM<span class="number">2</span>VcGfl<span class="number">96</span>S<span class="number">8</span>TihRzZvoroed<span class="number">6</span>t<span class="keyword">i6</span>WqEBmtzw<span class="number">3</span>Wodatg+VyOeph<span class="number">4</span>EYpr/<span class="number">1</span>wXKtx<span class="number">8</span>/</div><div class="line">wApIvJSwtmV<span class="keyword">i4</span>MFU<span class="number">5</span>aMqrSDE<span class="number">6</span>ea<span class="number">73</span>Mj<span class="number">2</span>tcMyo<span class="number">5</span>jMd<span class="number">6</span>jmeWUHK<span class="number">8</span>so/joWUoHOUgwu</div><div class="line">X<span class="number">4</span>Po<span class="number">1</span>QYz+<span class="number">3</span>dszkDqMp<span class="number">4</span>fklxBwXRsW<span class="number">10</span>KXzPMTZ+sOPAveyxindmjkW<span class="number">8</span>lGy+QsRlG</div><div class="line">PfZ+G<span class="number">6</span>Z<span class="number">6</span>h<span class="number">7</span>mjem<span class="number">0</span>Y+iWlkYcV<span class="number">4</span>PIWL<span class="number">1</span>iwB<span class="keyword">i8</span>saCbGS<span class="number">5</span>jN<span class="number">2</span>p<span class="number">8</span>M+X+Q<span class="number">7</span>UNKEkROb<span class="number">3</span>N<span class="number">6</span></div><div class="line">KOqkqm<span class="number">57</span>TH<span class="number">2</span>H<span class="number">3</span>eDJAkSnh<span class="number">6</span>/DNFu<span class="number">0</span>Qg==</div><div class="line">-----END CERTIFICATE-----</div></pre></td></tr></table></figure></p>
<p>生成SPKI指纹<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">openssl x509 -noout -<span class="keyword">in</span> ca.cer -pubkey | openssl asn1parse -noout -inform pem -out <span class="keyword">public</span>.<span class="keyword">key</span>;</div><div class="line">openssl dgst -sha256 -<span class="keyword">binary</span> <span class="keyword">public</span>.<span class="keyword">key</span> | openssl enc -base64</div></pre></td></tr></table></figure></p>
<p>得到结果</p>
<p><code>YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=</code></p>
<p>本来Pin是需要备份的，哥懒得折腾了，直接铆一下<code>AddTrust External CA Root</code></p>
<p><code>lCppFqbkrlJ3EcVFAkeip0+44VaoJUymbnOaEUk7tEU=</code></p>
<p>配置NGinx<br><figure class="highlight sml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">add_header <span class="type">Public</span>-<span class="type">Key</span>-<span class="type">Pins</span> <span class="symbol">'pin</span>-sha256=<span class="string">"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg="</span>; pin-sha256=<span class="string">"lCppFqbkrlJ3EcVFAkeip0+44VaoJUymbnOaEUk7tEU="</span> max-age=<span class="number">2592000</span>; includeSubDomains';</div></pre></td></tr></table></figure></p>
<p>重启，检测一下。</p>
<p><a href="https://report-uri.io/home/pkp_analyse/https%3A%2F%2Fbaiyangliu.com" target="_blank">report-uri</a><br><a href="https://www.ssllabs.com/ssltest/analyze.html?d=baiyangliu.com" target="_blank">ssllabs</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;以本站为例，采用的是Let’s Encrypt免费证书&lt;code&gt;Let&amp;#39;s Encrypt Authority X3&lt;/code&gt;，序列号为&lt;code&gt;‎0a 01 41 42 00 00 01 53 85 73 6a 0b 85 ec a7 08&lt;/code&gt;，以下是ca.cer&lt;br&gt;
    
    </summary>
    
      <category term="ssl" scheme="https://baiyangliu.com/categories/ssl/"/>
    
    
      <category term="ssl" scheme="https://baiyangliu.com/tags/ssl/"/>
    
  </entry>
  
  <entry>
    <title>刘氏家族</title>
    <link href="https://baiyangliu.com/%E5%88%98%E6%B0%8F%E5%AE%B6%E6%97%8F.html"/>
    <id>https://baiyangliu.com/刘氏家族.html</id>
    <published>2015-12-15T07:34:27.000Z</published>
    <updated>2016-12-22T01:36:13.716Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>
<h5 id="文刘金存先-汉朝宏正廷-学遵国法传-家宗义方兴"><a href="#文刘金存先-汉朝宏正廷-学遵国法传-家宗义方兴" class="headerlink" title="文刘金存先  汉朝宏正廷  学遵国法传  家宗义方兴"></a>文刘金存先  汉朝宏正廷  学遵国法传  家宗义方兴</h5><h5 id="德泽本延长-绒和道大光-敦行秉良善-积后自荣昌"><a href="#德泽本延长-绒和道大光-敦行秉良善-积后自荣昌" class="headerlink" title="德泽本延长  绒和道大光  敦行秉良善  积后自荣昌"></a>德泽本延长  绒和道大光  敦行秉良善  积后自荣昌</h5><h5 id="承宪须修治-饮崇亦裕世-隆培栽福基-进广安怀志"><a href="#承宪须修治-饮崇亦裕世-隆培栽福基-进广安怀志" class="headerlink" title="承宪须修治  饮崇亦裕世  隆培栽福基  进广安怀志"></a>承宪须修治  饮崇亦裕世  隆培栽福基  进广安怀志</h5><h5 id="纪钦喜成献-高明著述全-嘉猷常建恕-显达保辉联"><a href="#纪钦喜成献-高明著述全-嘉猷常建恕-显达保辉联" class="headerlink" title="纪钦喜成献  高明著述全  嘉猷常建恕  显达保辉联"></a>纪钦喜成献  高明著述全  嘉猷常建恕  显达保辉联</h5><h5 id="富有恒欲俊-端宣昭敏慎-履循贵用中-发祥永锡庆"><a href="#富有恒欲俊-端宣昭敏慎-履循贵用中-发祥永锡庆" class="headerlink" title="富有恒欲俊  端宣昭敏慎  履循贵用中  发祥永锡庆"></a>富有恒欲俊  端宣昭敏慎  履循贵用中  发祥永锡庆</h5>]]></content>
    
    <summary type="html">
    
      &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h5 id=&quot;文刘金存先-汉朝宏正廷-学遵国法传-家宗义方兴&quot;&gt;&lt;a href=&quot;#文刘金存先-汉朝宏正廷-学遵国法传-家宗义方兴&quot; class=&quot;headerlink&quot; title=&quot;文刘金存先  汉朝宏正廷  学遵国法传  家宗义方兴&quot;&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CentOS7 Strongswan IKEV2 架设梯子</title>
    <link href="https://baiyangliu.com/CentOS7-Strongswan-IKEV2-%E6%9E%B6%E8%AE%BE%E6%A2%AF%E5%AD%90.html"/>
    <id>https://baiyangliu.com/CentOS7-Strongswan-IKEV2-架设梯子.html</id>
    <published>2015-12-15T07:34:00.000Z</published>
    <updated>2016-12-22T01:36:53.167Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/imgs/firewall.jpg" alt="长城防火墙"><br><a id="more"></a><br>参考：<br>1.<a href="https://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7" target="_blank" rel="external">https://linsir.org/post/how_to_install_IPSec_IKEV2_base_on_strongswan_with_CentOS7</a><br>2.<a href="https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html" target="_blank" rel="external">https://raymii.org/s/tutorials/IPSEC_vpn_with_CentOS_7.html</a></p>
<h6 id="strongswan-sh"><a href="#strongswan-sh" class="headerlink" title="strongswan.sh"></a>strongswan.sh</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="comment">#strongswan.sh</span></div><div class="line"></div><div class="line">yum install strongswan -y</div><div class="line"></div><div class="line">yum install haveged -y</div><div class="line">systemctl <span class="built_in">enable</span> haveged</div><div class="line">systemctl start haveged</div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">cd</span> /etc/strongswan</div><div class="line">strongswan pki --gen --type rsa --size 4096 --outform der &gt; ipsec.d/private/ca.key.der</div><div class="line">chmod 600 ipsec.d/private/ca.key.der</div><div class="line"></div><div class="line"></div><div class="line">strongswan pki --self --ca --lifetime 7300 --in ipsec.d/private/ca.key.der --type rsa --dn <span class="string">"C=CN, O=VPN, CN=StrongSwan Root CA"</span> --outform der &gt; ipsec.d/cacerts/ca.crt.der</div><div class="line"></div><div class="line"></div><div class="line">strongswan pki --print --in ipsec.d/cacerts/ca.crt.der</div><div class="line">strongswan pki --gen --type rsa --size 4096 --outform der &gt; ipsec.d/private/vpn.key.der</div><div class="line">openssl x509 -inform DER -in ipsec.d/cacerts/ca.crt.der -out ipsec.d/cacerts/ca.crt.pem -outform PEM</div><div class="line">chmod 600 ipsec.d/private/vpn.key.der</div><div class="line"></div><div class="line"></div><div class="line">strongswan pki --pub --in ipsec.d/private/vpn.key.der --type rsa | strongswan pki --issue --lifetime 7300 --cacert ipsec.d/cacerts/ca.crt.der --cakey ipsec.d/private/ca.key.der --dn <span class="string">"C=CN, O=VPN, CN=vpn.0xa.in"</span> --san vpn.0xa.in --san 163.44.166.55  --san @163.44.166.55 --flag serverAuth --flag ikeIntermediate --outform der &gt; ipsec.d/certs/vpn.crt.der</div><div class="line">strongswan pki --print --in ipsec.d/certs/vpn.crt.der</div><div class="line">openssl x509 -inform DER -in ipsec.d/certs/vpn.crt.der -noout -text</div><div class="line"></div><div class="line"></div><div class="line">strongswan pki --gen --type rsa --size 4096 --outform der &gt; ipsec.d/private/baiyangliu.key.der</div><div class="line">chmod 600 ipsec.d/private/baiyangliu.key.der</div><div class="line">strongswan pki --pub --in ipsec.d/private/baiyangliu.key.der --type rsa | strongswan pki --issue --lifetime 7300 --cacert ipsec.d/cacerts/ca.crt.der --cakey ipsec.d/private/ca.key.der --dn <span class="string">"C=CN, O=VPN, CN=vpn.0xa.in"</span> --san <span class="string">"lc@baiyangliu.com"</span> --outform der &gt; ipsec.d/certs/baiyangliu.crt.der</div><div class="line">openssl rsa -inform DER -in ipsec.d/private/baiyangliu.key.der -out ipsec.d/private/baiyangliu.key.pem -outform PEM</div><div class="line">openssl x509 -inform DER -in ipsec.d/certs/baiyangliu.crt.der -out ipsec.d/certs/baiyangliu.crt.pem -outform PEM</div><div class="line">openssl pkcs12 -export  -inkey ipsec.d/private/baiyangliu.key.pem -in ipsec.d/certs/baiyangliu.crt.pem -name <span class="string">"Baiyangliu VPN Certificate"</span>  -certfile ipsec.d/cacerts/ca.crt.pem -caname <span class="string">"StrongSwan Root CA"</span> -out baiyangliu.vpn.p12</div></pre></td></tr></table></figure>
<h6 id="etc-strongswan-ipsec-conf"><a href="#etc-strongswan-ipsec-conf" class="headerlink" title="/etc/strongswan/ipsec.conf"></a>/etc/strongswan/ipsec.conf</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/etc/strongswan/ipsec.conf</span></div><div class="line"></div><div class="line">config setup</div><div class="line">    uniqueids=never</div><div class="line"></div><div class="line"></div><div class="line">conn %default</div><div class="line">    keyexchange=ike</div><div class="line">    left=%any</div><div class="line">    leftsubnet=0.0.0.0/0</div><div class="line">    right=%any</div><div class="line"></div><div class="line">conn IKE-BASE</div><div class="line">    ikelifetime=60m</div><div class="line">    keylife=20m</div><div class="line">    rekeymargin=3m</div><div class="line">    keyingtries=1</div><div class="line">    leftcert=vpn.crt.der</div><div class="line">    rightsourceip=10.0.18.0/24</div><div class="line"></div><div class="line">    </div><div class="line">conn ike2-eap</div><div class="line">    also=IKE-BASE</div><div class="line">    keyexchange=ikev2</div><div class="line">    ike=aes128-sha256-ecp256,aes256-sha384-ecp384,aes128-sha256-modp2048,aes128-sha1-modp2048,aes256-sha384-modp4096,aes256-sha256-modp4096,aes256-sha1-modp4096,aes128-sha256-modp1536,aes128-sha1-modp1536,aes256-sha384-modp2048,aes256-sha256-modp2048,aes256-sha1-modp2048,aes128-sha256-modp1024,aes128-sha1-modp1024,aes256-sha384-modp1536,aes256-sha256-modp1536,aes256-sha1-modp1536,aes256-sha384-modp1024,aes256-sha256-modp1024,aes256-sha1-modp1024!</div><div class="line">    esp=aes128gcm16-ecp256,aes256gcm16-ecp384,aes128-sha256-ecp256,aes256-sha384-ecp384,aes128-sha256-modp2048,aes128-sha1-modp2048,aes256-sha384-modp4096,aes256-sha256-modp4096,aes256-sha1-modp4096,aes128-sha256-modp1536,aes128-sha1-modp1536,aes256-sha384-modp2048,aes256-sha256-modp2048,aes256-sha1-modp2048,aes128-sha256-modp1024,aes128-sha1-modp1024,aes256-sha384-modp1536,aes256-sha256-modp1536,aes256-sha1-modp1536,aes256-sha384-modp1024,aes256-sha256-modp1024,aes256-sha1-modp1024,aes128gcm16,aes256gcm16,aes128-sha256,aes128-sha1,aes256-sha384,aes256-sha256,aes256-sha1!</div><div class="line">    leftsendcert=always</div><div class="line">    leftid=vpn.0xa.in</div><div class="line">    leftauth=pubkey</div><div class="line">    leftfirewall=yes</div><div class="line">    rightauth=eap-mschapv2</div><div class="line">    rightsendcert=never</div><div class="line">    eap_identity=%any</div><div class="line">    rekey=no</div><div class="line">    dpdaction=clear</div><div class="line">    fragmentation=yes</div><div class="line">    auto=add</div><div class="line"></div><div class="line"></div><div class="line">conn IPSec-IKEv1-PSK</div><div class="line">    also=IKE-BASE</div><div class="line">    keyexchange=ikev1</div><div class="line">    fragmentation=yes</div><div class="line">    leftauth=psk</div><div class="line">    rightauth=psk</div><div class="line">    rightauth2=xauth</div><div class="line">    auto=add</div><div class="line"></div><div class="line"></div><div class="line">conn IPSec-xauth</div><div class="line">    also=IKE-BASE</div><div class="line">    leftauth=psk</div><div class="line">    leftfirewall=yes</div><div class="line">    right=%any</div><div class="line">    rightauth=psk</div><div class="line">    rightauth2=xauth</div><div class="line">    auto=add</div></pre></td></tr></table></figure>
<h6 id="etc-strongswan-strongswan-conf"><a href="#etc-strongswan-strongswan-conf" class="headerlink" title="/etc/strongswan/strongswan.conf"></a>/etc/strongswan/strongswan.conf</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/etc/strongswan/strongswan.conf</span></div><div class="line"></div><div class="line">charon &#123;</div><div class="line">    load_modular = yes</div><div class="line">    duplicheck.enable = no</div><div class="line">    compress = yes</div><div class="line">    plugins &#123;</div><div class="line">        include strongswan.d/charon/*.conf</div><div class="line">    &#125;</div><div class="line">    dns1 = 8.8.8.8</div><div class="line">    dns2 = 8.8.4.4</div><div class="line">    </div><div class="line">    nbns1 = 8.8.8.8</div><div class="line">    nbns2 = 8.8.4.4</div><div class="line">&#125;</div><div class="line"></div><div class="line">include strongswan.d/*.conf</div></pre></td></tr></table></figure>
<h6 id="etc-strongswan-ipsec-secrets"><a href="#etc-strongswan-ipsec-secrets" class="headerlink" title="/etc/strongswan/ipsec.secrets"></a>/etc/strongswan/ipsec.secrets</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#/etc/strongswan/ipsec.secrets</span></div><div class="line"></div><div class="line">: RSA vpn.key.der</div><div class="line"></div><div class="line">username1 : EAP <span class="string">"password1"</span></div><div class="line">username2 : EAP <span class="string">"password2"</span></div><div class="line">username3 : EAP <span class="string">"password3"</span></div><div class="line">hipster: XAUTH <span class="string">"tbkiT571KxqpaKy/ap1H4kcWX0SZkogJ"</span></div></pre></td></tr></table></figure>
<h6 id="etc-sysctl-conf"><a href="#etc-sysctl-conf" class="headerlink" title="/etc/sysctl.conf"></a>/etc/sysctl.conf</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">net.ipv4.ip_forward = 1</div><div class="line">net.ipv4.conf.all.accept_redirects = 0</div><div class="line">net.ipv4.conf.all.send_redirects = 0</div></pre></td></tr></table></figure>
<h6 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=dmz --permanent --add-rich-rule=<span class="string">'rule protocol value="esp" accept'</span> <span class="comment"># ESP (the encrypted data packets)</span></div><div class="line">firewall-cmd --zone=dmz --permanent --add-rich-rule=<span class="string">'rule protocol value="ah" accept'</span> <span class="comment"># AH (authenticated headers)</span></div><div class="line">firewall-cmd --zone=dmz --permanent --add-port=500/udp <span class="comment">#IKE  (security associations)</span></div><div class="line">firewall-cmd --zone=dmz --permanent --add-port=4500/udp <span class="comment"># IKE NAT Traversal (IPsec between natted devices)</span></div><div class="line">firewall-cmd --permanent --add-service=<span class="string">"ipsec"</span></div><div class="line">firewall-cmd --zone=dmz --permanent --add-masquerade</div><div class="line">firewall-cmd --set-default-zone=dmz</div><div class="line">firewall-cmd --reload</div><div class="line">firewall-cmd --list-all</div></pre></td></tr></table></figure>
<h6 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sysctl -p</div><div class="line">systemctl <span class="built_in">enable</span> strongswan</div><div class="line">strongswan restart</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/imgs/firewall.jpg&quot; alt=&quot;长城防火墙&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="科学上网" scheme="https://baiyangliu.com/categories/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
    
      <category term="Strongswan" scheme="https://baiyangliu.com/tags/Strongswan/"/>
    
  </entry>
  
  <entry>
    <title>Windows添加开机启动</title>
    <link href="https://baiyangliu.com/Windows%E6%B7%BB%E5%8A%A0%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8.html"/>
    <id>https://baiyangliu.com/Windows添加开机启动.html</id>
    <published>2015-12-15T07:33:00.000Z</published>
    <updated>2016-12-22T01:36:22.430Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>un]</div><div class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>unOnce]</div><div class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>unServices]</div><div class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>unServicesOnce]</div><div class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows NT<span class="symbol">\C</span>urrentVersion<span class="symbol">\W</span>inlogon<span class="symbol">\U</span>serinit]</div><div class="line"></div><div class="line">[HKEY_CURRENT_USER<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>un]</div><div class="line">[HKEY_CURRENT_USER<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>unOnce]</div><div class="line">[HKEY_CURRENT_USER<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>unServices]</div><div class="line">[HKEY_CURRENT_USER<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows<span class="symbol">\C</span>urrentVersion<span class="symbol">\R</span>unServicesOnce]</div><div class="line">[HKEY_CURRENT_USER<span class="symbol">\S</span>oftware<span class="symbol">\M</span>icrosoft<span class="symbol">\W</span>indows NT<span class="symbol">\C</span>urrentVersion<span class="symbol">\W</span>indows]</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight taggerscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/di
    
    </summary>
    
      <category term="工具" scheme="https://baiyangliu.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Windows" scheme="https://baiyangliu.com/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>Nginx反向代理，tomcat request.getScheme() 总是返回http</title>
    <link href="https://baiyangliu.com/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%EF%BC%8Ctomcat-request-getScheme-%E6%80%BB%E6%98%AF%E8%BF%94%E5%9B%9Ehttp.html"/>
    <id>https://baiyangliu.com/Nginx反向代理，tomcat-request-getScheme-总是返回http.html</id>
    <published>2015-12-15T07:32:00.000Z</published>
    <updated>2016-12-22T01:36:27.578Z</updated>
    
    <content type="html"><![CDATA[<p>错误如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">request.getScheme()  <span class="comment">//总是 http，而不是实际的http或https  </span></div><div class="line">request.isSecure()  <span class="comment">//总是false（因为总是http）  </span></div><div class="line">request.getRemoteAddr()  <span class="comment">//总是 nginx 请求的 IP，而不是用户的IP  </span></div><div class="line">request.getRequestURL()  <span class="comment">//总是 nginx 请求的URL 而不是用户实际请求的 URL  </span></div><div class="line">response.sendRedirect( 相对url )  <span class="comment">//总是重定向到 http 上 （因为认为当前是 http 请求）</span></div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>解决办法：<br>修改nginx配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">proxy_set_header  Host $host;</div><div class="line">proxy_set_header  X-Real-IP  $remote_addr;</div><div class="line">proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">proxy_set_header  X-Forwarded-Proto  $scheme;</div><div class="line">proxy_pass        http://backends;</div></pre></td></tr></table></figure></p>
<p>修改tomcat（conf/server.xml），在Engine节点添加<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteIpValve"</span></span></div><div class="line">              <span class="attr">remoteIpHeader</span>=<span class="string">"X-Forwarded-For"</span></div><div class="line">              <span class="attr">protocolHeader</span>=<span class="string">"X-Forwarded-Proto"</span></div><div class="line">              <span class="attr">protocolHeaderHttpsValue</span>=<span class="string">"https"</span>/&gt;</div></pre></td></tr></table></figure></p>
<p>重启服务即可。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;错误如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;request.getScheme()  &lt;span class=&quot;comment&quot;&gt;//总是 http，而不是实际的http或https  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;request.isSecure()  &lt;span class=&quot;comment&quot;&gt;//总是false（因为总是http）  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;request.getRemoteAddr()  &lt;span class=&quot;comment&quot;&gt;//总是 nginx 请求的 IP，而不是用户的IP  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;request.getRequestURL()  &lt;span class=&quot;comment&quot;&gt;//总是 nginx 请求的URL 而不是用户实际请求的 URL  &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;response.sendRedirect( 相对url )  &lt;span class=&quot;comment&quot;&gt;//总是重定向到 http 上 （因为认为当前是 http 请求）&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="编码" scheme="https://baiyangliu.com/categories/%E7%BC%96%E7%A0%81/"/>
    
    
      <category term="Nginx" scheme="https://baiyangliu.com/tags/Nginx/"/>
    
      <category term="Tomcat" scheme="https://baiyangliu.com/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>让C# WebBrowser使用IE11</title>
    <link href="https://baiyangliu.com/%E8%AE%A9C#-WebBrowser%E4%BD%BF%E7%94%A8IE11.html"/>
    <id>https://baiyangliu.com/让C#-WebBrowser使用IE11.html</id>
    <published>2015-12-15T07:31:25.000Z</published>
    <updated>2016-12-22T01:36:04.127Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Windows Registry Editor Version 5.00</div><div class="line"></div><div class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>OFTWARE<span class="symbol">\M</span>icrosoft<span class="symbol">\I</span>nternet Explorer<span class="symbol">\M</span>AIN<span class="symbol">\F</span>eatureControl<span class="symbol">\F</span>EATURE_BROWSER_EMULATION]</div><div class="line">"xxx.exe"=dword:2af9</div><div class="line"></div><div class="line">[HKEY_LOCAL_MACHINE<span class="symbol">\S</span>OFTWARE<span class="symbol">\W</span>OW6432Node<span class="symbol">\M</span>icrosoft<span class="symbol">\I</span>nternet Explorer<span class="symbol">\M</span>AIN<span class="symbol">\F</span>eatureControl<span class="symbol">\F</span>EATURE_BROWSER_EMULATION]</div><div class="line">"xxx.exe"=dword:2af9</div></pre></td></tr></table></figure>
<p>将上述文件中的xxx.exe替换成你的程序名字，保存为.reg文件，运行即可。详情求参考：<a href="https://msdn.microsoft.com/en-us/library/ee330730(v=vs.85).aspx#browser_emulation" target="_blank" rel="external">https://msdn.microsoft.com/en-us/library/ee330730(v=vs.85).aspx#browser_emulation</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight taggerscript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/di
    
    </summary>
    
    
      <category term="c#" scheme="https://baiyangliu.com/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>博客搬家</title>
    <link href="https://baiyangliu.com/hello.html"/>
    <id>https://baiyangliu.com/hello.html</id>
    <published>2015-12-15T04:59:00.000Z</published>
    <updated>2016-12-22T01:36:44.810Z</updated>
    
    <content type="html"><![CDATA[<p>折腾过Wordpress，折腾过Discuzz，折腾过Ghost，折腾过国内的各个博客……折腾来折腾去，以前写的好些东西都被折腾没了。不想再折腾了，以后就Hexo了。</p>
]]></content>
    
    <summary type="html">
    
      小小白杨，博客搬家。
    
    </summary>
    
    
  </entry>
  
</feed>
